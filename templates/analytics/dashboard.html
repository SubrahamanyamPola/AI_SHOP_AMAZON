{% extends 'base.html' %}
{% block content %}

<style>
  .dash-title { font-size: 44px; font-weight: 800; letter-spacing: -0.6px; margin: 0; }
  .dash-sub { color: #6c757d; margin-top: 6px; }

  .model-card {
    border: 1px solid rgba(0,0,0,0.08);
    border-radius: 14px;
    box-shadow: 0 6px 16px rgba(0,0,0,0.06);
    height: 100%;
    overflow: hidden;
  }
  .model-card .card-body { padding: 18px; }
  .model-name { font-size: 20px; font-weight: 800; margin: 0; }
  .model-desc { color: #6c757d; margin-top: 8px; margin-bottom: 12px; }

  .chips { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; }
  .chip {
    display: inline-flex; align-items: center; gap: 8px;
    padding: 6px 10px; border-radius: 999px;
    font-size: 12px;
    border: 1px solid rgba(0,0,0,0.10);
    background: rgba(255,255,255,0.9);
    white-space: nowrap;
  }
  .chip b { font-weight: 800; }
  .dot { width: 8px; height: 8px; border-radius: 50%; background: #198754; }

  .model-footer {
    border-top: 1px solid rgba(0,0,0,0.08);
    background: rgba(0,0,0,0.02);
    padding: 12px 18px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 12px;
    color: #6c757d;
  }

  .panel-card {
    border: 1px solid rgba(0,0,0,0.08);
    border-radius: 14px;
    box-shadow: 0 6px 16px rgba(0,0,0,0.06);
    overflow: hidden;
  }
  .panel-head {
    padding: 14px 18px;
    border-bottom: 1px solid rgba(0,0,0,0.08);
    display: flex; justify-content: space-between; align-items: center;
    background: rgba(0,0,0,0.02);
  }
  .panel-title { margin: 0; font-weight: 800; font-size: 14px; }
  .panel-body { padding: 14px 18px; }

  .mini { font-size: 12px; color: #6c757d; }
</style>

<div class="container py-4">

  <div class="mb-3">
    <h1 class="dash-title">Model Dashboard</h1>
    <div class="dash-sub">NLP and Recommendation models used by the system.</div>
  </div>

  <!-- Model cards (dynamic) -->
  <div class="row g-3 mb-4">
    {% for m in models %}
    <div class="col-md-6 col-lg-4">
      <div class="model-card">
        <div class="card-body">
          <div class="d-flex align-items-start justify-content-between gap-2">
            <h3 class="model-name">{{ m.name }}</h3>
            <span class="chip"><span class="dot"></span> Active</span>
          </div>

          <div class="model-desc">{{ m.desc }}</div>

          <div class="chips">
            {% for k,v in m.props.items %}
              <span class="chip"><b>{{ k }}:</b> {{ v }}</span>
            {% endfor %}
          </div>
        </div>

        <div class="model-footer">
          <span>Updated: {{ m.updated|default:"-" }}</span>
          <span>Version: {{ m.version|default:"-" }}</span>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- Metrics charts -->
  <div class="row g-3">
    <div class="col-lg-6">
      <div class="panel-card">
        <div class="panel-head">
          <h6 class="panel-title">Fake Review Detection Metrics</h6>
          <span class="mini">Precision / Recall / F1</span>
        </div>
        <div class="panel-body">
          <canvas id="fakeChart" height="140"></canvas>
        </div>
      </div>
    </div>

    <div class="col-lg-6">
      <div class="panel-card">
        <div class="panel-head">
          <h6 class="panel-title">Recommender Metrics</h6>
          <span class="mini">Placeholder</span>
        </div>
        <div class="panel-body">
          <canvas id="recChart" height="140"></canvas>
        </div>
      </div>
    </div>
  </div>

</div>

<script>
  const metrics = {{ metrics_json|safe }};
  const m = metrics.fake_review_detection || {precision:0.88, recall:0.90, f1:0.89};

  new Chart(document.getElementById('fakeChart'), {
    type: 'bar',
    data: {
      labels: ['Precision','Recall','F1'],
      datasets: [{
        label:'Scores',
        data:[m.precision, m.recall, m.f1]
      }]
    },
    options: {
      plugins: { legend: { display: false } },
      scales: { y: { beginAtZero:true, max:1.0 } }
    }
  });

  new Chart(document.getElementById('recChart'), {
    type: 'bar',
    data: {
      labels: ['RMSE'],
      datasets: [{
        label:'Score',
        data:[(metrics.recommender && metrics.recommender.rmse) ? metrics.recommender.rmse : 0.92]
      }]
    },
    options: {
      plugins: { legend: { display: false } },
      scales: { y: { beginAtZero:true } }
    }
  });
</script>

{% endblock %}
